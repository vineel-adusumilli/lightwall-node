<html>
  <head>
    <title>LightWall</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.dematte.at/colorPicker/colorPicker/colorPicker.js" charset="UTF-8"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script>
      $(document).ready(function() {
        colorPicker.allowResize = false;
        colorPicker.allowClose = false;
        colorPicker.allowDrag = false;
        
        var socket = io.connect('http://' + window.location.hostname);
        var initialized = false;
        var wait = false;
        
        socket.on('update rgb', function(data) {
          if (!initialized) {
            $('#color').trigger('click');
            initialized = true;
          }
          colorPicker.importColor([data.r, data.g, data.b]);
          wait = true;
        });
        
        colorPicker.exportColor = function() {
          if (!wait) {
            var rgb = colorPicker.CP.rgb;
            socket.emit('illuminate', { r: rgb[0], g: rgb[1], b: rgb[2] });
          }
          wait = false;
        };
      });
    </script>
  </head>
  <body>
    <div id="color" style="display:none;" onclick="colorPicker(event);" />
  </body>
</html>
